# Session Summary - 2025-12-03 Session 1

## Objective
Add OpenTelemetry tracing instrumentation to API and Web UI calls for reinforcement learning integration.

---

## Context

The goal is to add comprehensive OpenTelemetry tracing that captures (state, action, reward) triplets to support reinforcement learning systems like Agent Lightning. This instrumentation will enable:
- Observability of all API calls and web UI interactions
- Data collection for RL training on system usage patterns
- Performance monitoring and optimization

---

## Prior Day Summary (December 2nd - 11 Sessions)

| Session | Focus | Key Outcome |
|---------|-------|-------------|
| 1 | Test coverage | 73%â†’78%, ADR 002 |
| 2 | PR merges | Merged 3 PRs, started web UI integration |
| 3 | Pre-commit | Added linting hooks |
| 4 | E2E tests | 24/24 passing, telemetry DB |
| 5-7 | Web UI | HITL, costs, sparklines, budget, traceability, dark mode, diff view |
| 8-9 | Bug fixes | Unicode fix, CI/CD lint fixes |
| 10 | Features | What-If simulator, +40 tests |
| 11 | Docs | README update (partial) |

**Current State:**
- Test coverage: 74%
- Web UI: 12/13 tasks complete
- All CI/CD pipelines passing

---

## OpenTelemetry Tracing Plan

### Target Areas for Instrumentation

1. **API Layer** (`src/asp/web/api.py`)
   - All database queries
   - External service calls
   - Data aggregation functions

2. **Web UI Routes**
   - `manager.py` - Manager dashboard endpoints
   - `developer.py` - Developer dashboard endpoints
   - `product.py` - Product manager endpoints
   - `main.py` - Core routes and health checks

3. **Data Layer** (`src/asp/web/data.py`)
   - Telemetry DB operations
   - Artifact file operations
   - Budget/settings persistence

4. **Orchestrators** (`src/asp/orchestrators/`)
   - TSP orchestration loops
   - Agent execution traces

### RL Triplet Structure (State, Action, Reward)

For Agent Lightning integration:
- **State**: Current system context (active agents, pending tasks, resource utilization)
- **Action**: User/agent operation being performed (API call, UI navigation, task execution)
- **Reward**: Outcome metrics (latency, success/failure, cost, tokens used)

---

## Tasks

- [ ] Research existing OpenTelemetry patterns in codebase
- [ ] Design span structure for RL triplets
- [ ] Add OpenTelemetry dependencies
- [ ] Instrument API layer
- [ ] Instrument Web UI routes
- [ ] Instrument data layer
- [ ] Add exporter configuration
- [ ] Create documentation

---

## Files to Modify

(To be updated as work progresses)

---

## Technical Notes

- OpenTelemetry Python SDK: `opentelemetry-api`, `opentelemetry-sdk`
- Exporters to consider: OTLP, Jaeger, Zipkin, Console
- Consider automatic instrumentation for FastHTML/Starlette

---

## Status
In Progress - Planning phase
